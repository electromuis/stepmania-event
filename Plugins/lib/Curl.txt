include("ExternalProject")

#ExternalProject_Add(Curl
#    PREFIX extern
#    #--Download step--------------
#    URL https://curl.se/windows/dl-7.82.0_2/curl-7.82.0_2-win64-mingw.zip
#    URL_HASH SHA256=8741fc3cf3f26c9fc1dc760d406db36c8519d470ebce75634715a355a323e3af
#    CONFIGURE_COMMAND ""
#    BUILD_COMMAND ""
#    UPDATE_COMMAND ""
#    INSTALL_COMMAND ""
#)
#set(CURL_INCLUDE_DIR "${CMAKE_CURRENT_BINARY_DIR}/extern/src/Curl/include")
#set(CURL_LIBRARY "${CMAKE_CURRENT_BINARY_DIR}/extern/src/Curl/lib/libcurl.dll.a")
#link_directories(${CMAKE_CURRENT_BINARY_DIR}/extern/src/Curl/lib/)

ExternalProject_Add(Curl
  CMAKE_ARGS
	-DCURL_USE_SCHANNEL=ON
    -DCMAKE_CXX_FLAGS_DEBUG=/MTd
  GIT_REPOSITORY https://github.com/curl/curl
  GIT_TAG master
  UPDATE_COMMAND ""
  INSTALL_COMMAND ""
)

set(CURL_INCLUDE_DIR "${CMAKE_CURRENT_BINARY_DIR}/Curl-prefix/src/Curl/include")
set(CURL_LIBRARY "${CMAKE_CURRENT_BINARY_DIR}/CurlPP-prefix/src/Curl-build/lib/Debug/libcurl-d_imp.lib")

FIND_PACKAGE(CURL REQUIRED)

ExternalProject_Add(CurlPP
  CMAKE_ARGS
	-DCURL_INCLUDE_DIR=${CURL_INCLUDE_DIR}
	-DCURL_LIBRARY=${CURL_LIBRARY}
	-DCURLPP_BUILD_SHARED_LIBS=OFF
    -DCMAKE_CXX_FLAGS_DEBUG=/MTd
  GIT_REPOSITORY https://github.com/jpbarrette/curlpp
  GIT_TAG master
  UPDATE_COMMAND ""
  INSTALL_COMMAND ""
)

add_dependencies(CurlPP Curl)

link_directories(
	${CMAKE_CURRENT_BINARY_DIR}/Curl-prefix/src/Curl-build/Debug
	${CMAKE_CURRENT_BINARY_DIR}/CurlPP-prefix/src/CurlPP-build/Debug
)

include_directories(
	${CURL_INCLUDE_DIR}
	${CMAKE_CURRENT_BINARY_DIR}/CurlPP-prefix/src/CurlPP/include
)